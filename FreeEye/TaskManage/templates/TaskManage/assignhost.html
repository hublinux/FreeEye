{% load staticfiles %}
    <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">×</span><span class="sr-only">Close</span></button>
        <h6 class="modal-title">分配主机</h6>
    </div>
    <div class="modal-body" style="padding-bottom: 10px;">
        <div class="content" id="setBranchs_Modal_content">
        <div class="row">
            <div class="col-sm-4">
                <div class="slimScrollDiv" style="position: relative; width: 100%; height: 400px;">
                    <div id="hostgroupTree" class="treeview" style="width: 100%; height: 400px;">
                    </div>
                </div>
            </div>
            <div class="col-sm-4" style="border-right: dashed; border-left: dashed;border-width: 1px;">
                <div class="slimScrollDiv" style="position: relative; width: 100%; height: 400px;">
                    <div class="form-group" id="detailHostList" style="width: 100%; height: 400px;">
                        <!-- <div class="checkbox i-checks">
                            <label>
                                <div class="icheckbox_square-green" style="position: relative;">
                                    <input id="selectAll" type="checkbox" value="0" style="position: absolute; opacity: 0;">
                                    <ins class="iCheck-helper" style="position: absolute; top: 0%; left: 0%; display: block; width: 100%; height: 100%; margin: 0px; padding: 0px; background: rgb(255, 255, 255); border: 0px; opacity: 0;"></ins>
                                </div>
                                <i></i>全选
                            </label>
                        </div>
                        <div class="checkbox i-checks">
                            <label>
                                <div class="icheckbox_square-green" style="position: relative;">
                                    <input id="check_42" type="checkbox" value="42" style="position: absolute; opacity: 0;">
                                    <ins class="iCheck-helper" style="position: absolute; top: 0%; left: 0%; display: block; width: 100%; height: 100%; margin: 0px; padding: 0px; background: rgb(255, 255, 255); border: 0px; opacity: 0;"></ins>
                                </div>
                                <i></i> 深圳CBD中心
                            </label>
                        </div> -->
                    </div>
                    <!-- <div class="slimScrollBar" style="background: rgb(170, 187, 204); width: 5px; position: absolute; top: 0px; opacity: 0.4; display: block; border-radius: 7px; z-index: 99; right: 5px; height: 74.4879px;">
                    </div>
                    <div class="slimScrollRail" style="width: 5px; height: 100%; position: absolute; top: 0px; display: none; border-radius: 7px; background: rgb(51, 51, 51); opacity: 0.2; z-index: 90; right: 5px;"></div> -->
                </div>
            </div>
            <div class="col-sm-4">
                <div class="slimScrollDiv" style="position: relative; width: 100%; height: 400px;">
                    <ol id="selectHostShow" style="width: 100%; height: 400px;">
                    </ol>
                    <!-- <div class="slimScrollBar" style="background: rgb(170, 187, 204); width: 5px; position: absolute; top: 0px; opacity: 0.4; display: none; border-radius: 7px; z-index: 99; right: 5px; height: 400px;"></div>
                    <div class="slimScrollRail" style="width: 5px; height: 100%; position: absolute; top: 0px; display: none; border-radius: 7px; background: rgb(51, 51, 51); opacity: 0.2; z-index: 90; right: 5px;"></div> -->
                </div>
            </div>
        </div>
    </div>


<script src="{% static 'Hplus/js/plugins/treeview/bootstrap-treeview.js' %}"></script>
<script src="{% static 'Hplus/js/plugins/iCheck/icheck.min.js' %}"></script>
<script type="text/javascript">
    function CheckInit(){
        $('#detailHostList .i-checks').iCheck({
            checkboxClass:'icheckbox_square-green',
            radioClass:'iradio_square-green',
        });
    }
    function InitEvent(){
        var allCheckElements = $('#detailHostList input[id!=selectAll]');
        $.each(allCheckElements, function(index, element){
            var status = this.checked;
            if (status){
                var text = $.trim($(this).parents('label').text());
                var htmlString = `<li hostId="${this.value}" id='host_${this.value}'>${text}&nbsp;<a href="javascript:void(0);"
                    onclick="RemoveSelected('${this.value}');"><i class="fa fa-trash"></i></a></li>`;
                if ($('#host_'+this.value).length == 0){$('#selectHostShow').append(htmlString);}
            }
        });
        $('#selectAll').on('ifChanged',function(event){
            var status = this.checked;
            var allCheckElements = $('#detailHostList input[id!=selectAll]');
            $.each(allCheckElements, function(index, element){
                $(element).iCheck(status?'check':'uncheck');
            });
        });
        $('#detailHostList input[id!=selectAll]').on('ifChanged',function(event){
            var status = this.checked;
            if (status){
                var text = $.trim($(this).parents('label').text());
                var htmlString = `<li hostId="${this.value}" id='host_${this.value}'>${text}&nbsp;<a href="javascript:void(0);"
                    onclick="RemoveSelected('${this.value}');"><i class="fa fa-trash"></i></a></li>`;
                if ($('#host_'+this.value).length == 0){$('#selectHostShow').append(htmlString);}
            }
            else{
                $('#host_'+this.value).remove()
            }
        });
    }
    function RemoveSelected(id){
        var liId ='host_'+id;
        $('#'+liId).remove();
        if($('#check_'+id).length>0)$('#check_'+id).iCheck('uncheck');
    }
    function RemoveAllSelected(){
        var $ulElement = $('selectHostShow');
        if ($ulElement.length>0)$ulElement.empty();
    }
    $(function(){
        $.ajax({
            url:'/TaskManage/GetHostGroup/',
            type:'post',
            success:function(msg){
                $('#hostgroupTree').treeview({
                    data:msg,
                    onNodeSelected:function(event, node){
                        var groupid = node.groupid;
                        $.ajax({
                            url:'/TaskManage/GetHost/',
                            type:'post',
                            data:{groupid:groupid},
                            success:function(data){
                                $('#detailHostList').empty();
                                var defaultCheck =`<div class = "check i-checks"><label>
                                        <input id="selectAll" type="checkbox" value="0"><i></i> 全选
                                    </label></div>`
                                $('#detailHostList').append(defaultCheck);
                                for (var i in data){
                                    d = data[i]
                                    var checkHtml = `<div class = "check i-checks"><label>
                                            <input id="check_${d.id}" type="checkbox" value="${d.id}" ${d.isSelected?"checked":""}><i></i> ${d.name}
                                        </label></div>`
                                    $('#detailHostList').append(checkHtml);
                                    CheckInit();
                                    InitEvent();
                                }
                            }
                        });
                    }
                });
            }
        });
        $('#hostgroupTree').slimScroll({
            width:'100%',
            height:'400px',
            size:'5px',
            color:'#abc',
            distance:'5px',
            alwaysVisible:true,
        });
        $('#detailHostList').slimScroll({
            width:'100%',
            height:'400px',
            size:'5px',
            color:'#abc',
            distance:'5px',
            alwaysVisible:true,
        });
        $('#selectSchoolShow').slimScroll({
            width:'100%',
            height:'400px',
            size:'5px',
            color:'#abc',
            distance:'5px',
            alwaysVisible:true,
        });
    })
</script>
    <div class="modal-footer">
        <button type="button" class="btn btn-danger" onclick="SetBranchsFunctions.RemoveAllSelectedShools();">清空</button>
        <button type="button" class="btn btn-white" data-dismiss="modal">关闭</button>
        <button type="button" class="btn btn-primary" onclick="SetBranchsFunctions.SaveUserBranchs();">保存</button>
    </div>
